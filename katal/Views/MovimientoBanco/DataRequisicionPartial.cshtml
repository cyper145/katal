
@using katal.conexion.model.entity;
@using katal.Model;
@(Html.DevExpress().GridView<CMovimientoBanco>(settings => {
    settings.Name = "gridView";
    settings.Enabled = GridViewHelper.activeData;
    settings.CallbackRouteValues = new { Controller = "MovimientoBanco", Action = "DataRequisicionPartial" };
    settings.CustomActionRouteValues = new { Controller = "MovimientoBanco", Action = "GridViewCustomActionPartial" };
    settings.SettingsEditing.AddNewRowRouteValues = new { Controller = "MovimientoBanco", Action = "RequisicionAddNewPartial" };
    settings.SettingsEditing.UpdateRowRouteValues = new { Controller = "MovimientoBanco", Action = "RequisicionUpdatePartial" };
    settings.SettingsResizing.ColumnResizeMode = ColumnResizeMode.Control;
    settings.ControlStyle.CssClass = "grid-view";
    settings.Styles.Cell.Wrap = DefaultBoolean.False;
    settings.Styles.PagerBottomPanel.CssClass = "pager";
    settings.Styles.FocusedRow.CssClass = "focused";
    settings.SettingsEditing.Mode = GridViewEditingMode.PopupEditForm;
    settings.SettingsPopup.EditForm.SettingsAdaptivity.MaxWidth = 1200;
    settings.SettingsPopup.EditForm.SettingsAdaptivity.Mode = PopupControlAdaptivityMode.Always;
    settings.SettingsPopup.EditForm.SettingsAdaptivity.VerticalAlign = PopupAdaptiveVerticalAlign.WindowCenter;
    settings.EditFormLayoutProperties.SettingsAdaptivity.AdaptivityMode = FormLayoutAdaptivityMode.SingleColumnWindowLimit;
    settings.EditFormLayoutProperties.SettingsAdaptivity.SwitchToSingleColumnAtWindowInnerWidth = 500;
    settings.EditFormLayoutProperties.UseDefaultPaddings = false;
    settings.EditFormLayoutProperties.SettingsItemCaptions.Location = LayoutItemCaptionLocation.Top;
    settings.EditFormLayoutProperties.Styles.LayoutGroup.Cell.Paddings.Padding = Unit.Pixel(3);
    settings.EditFormLayoutProperties.Styles.LayoutItem.Paddings.PaddingBottom = Unit.Pixel(8);
    settings.Settings.ShowFilterRowMenu = true;
    settings.SettingsBehavior.AllowFocusedRow = true;
    // settings.SettingsBehavior.
    settings.KeyFieldName = "CB_C_SECUE";
    settings.Columns.Add(column =>
    {
        column.FieldName = "CB_C_SECUE";
        column.Caption = "Secuencia";
    });
    settings.Columns.Add(column =>
    {
        column.FieldName = "Opera";
        column.Caption = "Operacion";
    });
    settings.Columns.Add(column =>
    {
        column.FieldName = "docu";
        column.Caption = "Documento";
    });
    settings.Columns.Add(column =>
    {
        column.FieldName = "MONTO";
        column.Caption = "Monto MN";
    });
    settings.Columns.Add(column =>
    {
        column.FieldName = "Conta";
        column.Caption = "Contab.";
    });
    settings.Columns.Add(column =>
    {
        column.FieldName = "Anula";
        column.Caption = "Anulado";
    });

    //Anulado
    settings.Columns.Add(column =>
    {
        column.FieldName = "CB_D_Fecha";
        column.Caption = "Fecha.";
        column.ColumnType = MVCxGridViewColumnType.DateEdit;
    });
    settings.Columns.Add(column =>
    {
        column.FieldName = "CB_C_Anexo";
        column.Caption = "Anexo";
    });
    settings.Columns.Add(column =>
    {
        column.FieldName = "CB_A_REFERV";
        column.Caption = "Glosa";
    });
    settings.SetEditFormTemplateContent(c =>
    {
        Html.DevExpress().FormLayout(layoutSetting =>
        {
            layoutSetting.Name = "FormLayoutSetting";
            layoutSetting.Width = Unit.Percentage(100);
            layoutSetting.SettingsAdaptivity.AdaptivityMode = FormLayoutAdaptivityMode.SingleColumnWindowLimit;
            layoutSetting.SettingsAdaptivity.SwitchToSingleColumnAtWindowInnerWidth = 700;
            layoutSetting.UseDefaultPaddings = false;
            var groupItem = layoutSetting.Items.AddGroupItem(groupSettings =>
            {
                groupSettings.Caption = "Registro de movimiento";
                //  groupSettings.ShowCaption = DefaultBoolean.False;
                groupSettings.GroupBoxDecoration = GroupBoxDecoration.Default;
                groupSettings.ColumnCount = 12;
            });
            groupItem.Items.Add(i =>
            {
                i.FieldName = "CB_C_SECUE";
                i.Caption = "Sec";
                i.ColumnSpan = 2;
                i.NestedExtension().TextBox(t =>
                {
                    t.Properties.ClientSideEvents.Init = "initSecuencia";
                    t.ReadOnly = true;
                });
            });
            groupItem.Items.Add(i =>
            {
                i.FieldName = "CB_C_MODO";
                i.Caption = "Tipo";
                i.ColumnSpan = 2;
                i.NestedExtension().ComboBox(t =>
                {

                    t.Properties.ValueType = typeof(string);
                    t.Properties.Items.Add("INGRESO", "I");
                    t.Properties.Items.Add("SALIDA", "S");
                    t.Properties.ValidationSettings.Display = Display.Dynamic;
                    t.ShowModelErrors = true;
                    t.Properties.ClientSideEvents.SelectedIndexChanged = "OnTipo";
                    t.Properties.ClientSideEvents.Init = "initTipo";
                    t.Properties.ClientSideEvents.KeyDown = "KeyDownModo";
                });
            });
            groupItem.Items.Add(i =>
            {
                i.FieldName = "CB_C_OPERA";
                i.Caption = "Operacion";
                i.ColumnSpan = 8;
                i.SetNestedContent(() =>
                {
                    Html.RenderAction("MultiSelectOpciones", new { CB_C_CODIG = DataBinder.Eval(c.DataItem, "CB_C_OPERA") });
                });
            });
            groupItem.Items.Add(i =>
            {
                i.FieldName = "CB_C_TPDOC";
                i.Caption = "Dcmtos";
                i.ColumnSpan = 4;
                i.SetNestedContent(() =>
                {
                    Html.RenderAction("MultiSelectTipoDoc", new { TIPDOC_CODIGO = DataBinder.Eval(c.DataItem, "CB_C_TPDOC") });
                });

            });
            groupItem.Items.Add(i =>
            {
                i.FieldName = "serie";


                i.ShowCaption = DefaultBoolean.False;
                i.ColumnSpan = 1;
                i.NestedExtension().TextBox(t =>
                {
                    t.Properties.ClientSideEvents.KeyDown = "KeyDownSerie";
                });
            });
            groupItem.Items.Add(i =>
            {

                i.FieldName = "CB_C_DOCUM";
                i.ShowCaption = DefaultBoolean.False;
                i.ColumnSpan = 1;
                i.NestedExtension().TextBox(t =>
                {
                    t.Properties.ClientSideEvents.KeyDown = "KeyDownDocum";
                });
            });

            groupItem.Items.Add(i =>

            {
                i.Name = "TipoAnexo";
                i.Caption = "Anexo";
                i.ColumnSpan = 3;
                i.SetNestedContent(() =>
                {
                    Html.RenderAction("MultiSelectTipoAnexo" , new { TIPOANEX_CODIGO = DataBinder.Eval(c.DataItem, "CB_C_ANEXO") });
                });
            });
            groupItem.Items.Add(i =>
            {
                i.FieldName = "CB_C_ANEXO";
                i.ShowCaption = DefaultBoolean.False;
                i.ColumnSpan = 3;
                i.SetNestedContent(() =>
                {
                    Html.RenderAction("MultiSelectAnexo", new { ANEX_CODIGO = DataBinder.Eval(c.DataItem, "CB_C_ANEXO") });
                });
            });
            groupItem.Items.Add(i =>
            {
                i.FieldName = "CB_C_CONVE";
                i.Caption = "Conversion";
                //  i.ShowCaption = DefaultBoolean.False;
                i.ColumnSpan = 3;
                i.SetNestedContent(() =>
                {
                    Html.RenderAction("MultiSelectMoneda", new { COVMON_CODIGO = DataBinder.Eval(c.DataItem, "CB_C_CONVE") });
                });
            });
            groupItem.Items.Add(i =>
            {
                i.Name = "CB_N_CAMES";
                i.Caption = "T/C Esp";
                // i.ShowCaption = DefaultBoolean.False;
                i.ColumnSpan = 3;
                i.NestedExtension().TextBox(t =>
                {
                    t.ReadOnly = true;
                    t.Properties.ClientSideEvents.KeyDown = "KeyDownEspecial";
                });
            });
            groupItem.Items.Add(i =>
            {
                i.FieldName = "CB_D_FECHA";
                i.ColumnSpan = 3;
                i.Caption = "F. Giro";
                i.RequiredMarkDisplayMode = FieldRequiredMarkMode.Hidden;
                i.NestedExtension().DateEdit(t =>
                {
                    t.Properties.ValidationSettings.Display = Display.Dynamic;
                    t.ShowModelErrors = true;
                    // t.Properties.ValidationSettings= ValidationSettings
                    //  t.Properties.AllowNull = true;
                    t.Properties.ClientSideEvents.Init = "dateInit";
                    t.Properties.ClientSideEvents.KeyDown = "KeyDownFechaGiro";
                });
            });
            groupItem.Items.Add(i =>
            {
                i.FieldName = "CB_D_FECCOB";
                i.ColumnSpan = 3;
                i.Caption = "F. Cobro";
                i.RequiredMarkDisplayMode = FieldRequiredMarkMode.Hidden;
                i.NestedExtension().DateEdit(t =>
                {
                    t.Properties.ValidationSettings.Display = Display.Dynamic;
                    t.ShowModelErrors = true;
                    t.Properties.ClientSideEvents.KeyDown = "KeyDownFechaCobro";
                });
            });
            groupItem.Items.Add(i =>
            {
                i.FieldName = "CB_N_MTOMN";
                i.ColumnSpan = 12;
                i.Caption = "Monto";
                i.Visible = false;

                i.NestedExtension().TextBox(t =>
                {
                    t.Properties.ValidationSettings.Display = Display.Dynamic;
                    t.ShowModelErrors = true;
                    t.Width = Unit.Percentage(25);
                    t.Properties.ClientSideEvents.KeyDown = "KeyDownMonto";
                });
            });
            groupItem.Items.Add(i =>
            {
                i.FieldName = "CB_A_REFER";
                i.ColumnSpan = 6;
                i.Caption = "Referencia";
                i.NestedExtension().TextBox(t =>
                {
                    t.Properties.ValidationSettings.Display = Display.Dynamic;
                    t.ShowModelErrors = true;
                    t.Properties.ClientSideEvents.KeyDown = "KeyDownReferencia";
                });
            });
            groupItem.Items.Add(i =>
            {
                i.Name = "CB_C_ESTAD";
                i.ColumnSpan = 3;
                i.Caption = "Estado";
                i.SetNestedContent(() =>
                {
                    Html.RenderAction("MultiSelectEstadosOperaciones", new { CB_C_CODIG = DataBinder.Eval(c.DataItem, "CB_C_ESTAD") });
                });
            });
            groupItem.Items.Add(i =>
            {
                i.Name = "CB_TIPMOV";
                i.ColumnSpan = 3;
                i.Caption = "Tipo";
                i.SetNestedContent(() =>
                {
                    Html.RenderAction("MultiSelectTiposMovimientos",new { CB_C_CODIG = DataBinder.Eval(c.DataItem, "CB_TIPMOV") });
                });
            });
            groupItem.Items.Add(i =>
            {
                i.Name = "TC";
                i.ColumnSpan = 1;
                i.Visible = false;
                i.Caption = "T/C";
                i.NestedExtension().TextBox(t =>
                {
                    t.Properties.ValidationSettings.Display = Display.Dynamic;
                    t.ShowModelErrors = true;
                    t.Properties.ClientSideEvents.KeyDown = "KeyDownTc";
                });
            });
            groupItem.Items.Add(i =>
            {
                i.Name = "CB_MEDIO:";
                i.ColumnSpan = 6;
                i.Caption = "Medio Pago";
                i.SetNestedContent(() =>
                {
                    Html.RenderAction("MultiSelectMedioPago");
                });
            });
            groupItem.Items.Add(i =>
            {
                i.Name = "creditos";
                i.ColumnSpan = 2;
                i.Caption = "Créditos";
                i.NestedExtension().CheckBox(t =>
                {
                    t.Properties.ValidationSettings.Display = Display.Dynamic;
                    t.ShowModelErrors = true;
                });
            });
            groupItem.Items.Add(i =>
            {
                i.Name = "Interface";
                i.ColumnSpan = 2;
                i.Caption = "Con Interface.";
                i.NestedExtension().CheckBox(t =>
                {
                    t.Properties.ValidationSettings.Display = Display.Dynamic;
                    t.ShowModelErrors = true;                    //  t.ReadOnly = true;
                });
            });
            groupItem.Items.Add(itemSettings =>
            {
                itemSettings.ColumnSpan = 2;
                itemSettings.ShowCaption = DefaultBoolean.False;
            }).SetNestedContent(() =>
            {
                Html.DevExpress().Button(
                    btnSettings =>
                    {
                        btnSettings.Width = Unit.Percentage(100);
                        btnSettings.Name = "btShowModal";
                        btnSettings.Text = "";
                        btnSettings.ToolTip = "Guardar";
                        btnSettings.Images.Image.Url = "Content/Images/save.svg";
                        btnSettings.Images.Image.Width = Unit.Percentage(10);
                        // magia de guardadr
                        btnSettings.ClientSideEvents.Click = "probando";

                    }).Render();
            });//2
            layoutSetting.Items.Add(itemSettings =>
            {

                itemSettings.ShowCaption = DefaultBoolean.False;
                itemSettings.SetNestedContent(() =>
                {
                    Html.RenderAction("Detail", new { CB_C_SECUE = DataBinder.Eval(c.DataItem, "CB_C_SECUE") });
                });
            });
            layoutSetting.Items.Add(itemSettings =>
            {
                itemSettings.ShowCaption = DefaultBoolean.False;
            }).SetNestedContent(() =>
            {
                ViewContext.Writer.Write("<div style='float:right'>");
                Html.DevExpress().Button(
                    btnSettings =>
                    {
                        btnSettings.Name = "btnUpdate";
                        btnSettings.Text = "Grabar";
                        btnSettings.ClientSideEvents.Click = "function(s, e){ gridView.CancelEdit(); }";// algo mas ara pero ahorita no

                    }).Render();
                Html.DevExpress().Button(
                    btnSettings =>
                    {
                        btnSettings.Name = "btnCancel";
                        btnSettings.Text = "Cancel";
                        btnSettings.Style[HtmlTextWriterStyle.MarginLeft] = "5px";
                        btnSettings.ClientSideEvents.Click = "function(s, e){ gridView.CancelEdit(); }";
                    }).Render();
                ViewContext.Writer.Write("</div>");
            });
        }).Bind(ViewData["Object"] ?? c.DataItem).Render();

    });
    settings.SettingsSearchPanel.CustomEditorName = "search";
    settings.SettingsBehavior.AllowFocusedRow = true;
    settings.SettingsExport.EnableClientSideExportAPI = true;
    settings.SettingsExport.ExcelExportMode = DevExpress.Export.ExportType.DataAware;
    settings.ClientSideEvents.FocusedRowChanged = "OnGridFocusedRowChangedRequision";
    settings.Width = Unit.Percentage(100);
    katal.Code.Helpers.GridViewFeaturesHelper.SetupGlobalGridViewBehavior(settings);
}).Bind(Model.cMovimientoBancos).SetEditErrorText(ViewBag.EditError).GetHtml())
